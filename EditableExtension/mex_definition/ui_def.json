{
  "firstPage": "JobProductListPage",
  "pages": {
    "JobProductListPage": {
      "title": "JobProductListPage.JobProductTitle",
      "type": "list",
      "addNew": {
        "text": "JobProductListPage.Add",
        "destinationPage": "UpsertJobProductPage",
        "defaultData": {
          "data": {
            "JobId": "${metadata.contextObjectId}"
          },
          "objectName": "JobProducts"
        }
      },
      "sourceExpression": "formData.JobProducts",
      "emptyText": "JobProductListPage.Empty",
      "search": {
        "placeholder": "JobProductListPage.SearchPlaceholder",
        "filterOnProperties": ["Product.Name", "Product.Description"]
      },
      "itemLayout": {
        "type": "titleAndCaption",
        "title": "JobProductListPage.ItemTitle",
        "caption": "JobProductListPage.ItemCaption"
      },
      "itemClickDestination": "UpsertJobProductPage"
    },
    "UpsertJobProductPage": {
      "type": "flat",
      "upsert": {
        "insertTitle": "UpsertJobProductPage.AddProduct",
        "updateTitle": "UpsertJobProductPage.EditProduct",
        "insertButtonText": "UpsertJobProductPage.Add",
        "updateButtonText": "UpsertJobProductPage.Update",
        "defaultDataForNewObject": {
          "CreatedDate": "${now()}"
        },
        "validator": [],
        "saveDraft": {
          "askWhenBack": true
        }
      },
      "delete": {
        "canDeleteExpression": "converters.data.isTempUID(pageData) == false",
        "text": "UpsertJobProductPage.DeleteJobProduct",
        "confirm": {
          "title": "UpsertJobProductPage.ConfirmDeleteTitle",
          "description": "UpsertJobProductPage.ConfirmDeleteDescription",
          "yesBtn": "UpsertJobProductPage.ConfirmDeleteYesButton",
          "noBtn": "UpsertJobProductPage.ConfirmDeleteNoButton"
        }
      },
      "saveDraft": {
        "askWhenBack": true
      },
      "items": [
        {
          "type": "selectEditor",
          "title": "UpsertJobProductPage.SearchProduct",
          "structureExpression": "pageData.Product",
          "valueExpression": "pageData.ProductId",
          "sourceExpression": "sharedData.Products",
          "displayExpression": "pageData.Product.Name",
          "placeholder": "UpsertJobProductPage.SelectProductHint",
          "selectPage": {
            "itemTitle": "JobProductSelectPage.ItemTitle",
            "emptyText": "JobProductSelectPage.Empty",
            "title": "JobProductSelectPage.Title",
            "itemCaption": "JobProductSelectPage.ItemCaption",
            "searchBar": {
              "filterOnProperties": ["Name", "Description"]
            }
          },
          "validator": [
            {
              "type": "expression",
              "expression": "pageData.ProductId",
              "errorMessage": "UpsertJobProductPage.JobProductIsRequired"
            }
          ]
        },
        {
          "type": "readonlyTextView",
          "showIfExpression": "pageData.Product",
          "title": "UpsertJobProductPage.DescriptionTitle",
          "text": "UpsertJobProductPage.SelectProductDescription"
        },
        {
          "type": "textEditor",
          "keyboardType": "number-pad",
          "valueExpression": "pageData.Qty",
          "title": "UpsertJobProductPage.Quantity",
          "placeholder": "UpsertJobProductPage.QuantityHint",
          "validator": [
            {
              "type": "expression",
              "errorMessage": "UpsertJobProductPage.QuantityMustBeAbove0",
              "expression": "pageData.Qty > 0 && pageData.Qty <= 1000"
            }
          ]
        },
        {
          "type": "textEditor",
          "valueExpression": "pageData.BatchNumber",
          "title": "UpsertJobProductPage.BatchNumber",
          "placeholder": "UpsertJobProductPage.BatchNumberHint",
          "validator": [
            {
              "type": "expression",
              "errorMessage": "UpsertJobProductPage.BatchNumberMustBeBelow255",
              "expression": "!pageData.BatchNumber || pageData.BatchNumber.length <= 255"
            }
          ]
        }
      ]
    }
  }
}
